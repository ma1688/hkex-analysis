# CLIé…ç½®è·¯å¾„ä¿®å¤æŠ¥å‘Š

**æ—¶é—´**: 2025-10-25 13:25:16
**ä»»åŠ¡**: ä¿®å¤CLIå‘½ä»¤ "Document Agentæœªå¯ç”¨" é”™è¯¯
**çŠ¶æ€**: âœ… å·²å®Œæˆ

## é—®é¢˜æè¿°

ç”¨æˆ·åœ¨è¿è¡Œ `hkex-agent chat -d` å‘½ä»¤æ—¶é‡åˆ°æŠ¥é”™ï¼š

```
é”™è¯¯: Document Agentæœªå¯ç”¨ï¼Œè¯·æ£€æŸ¥config/agents.yaml
```

## æ ¹æœ¬åŸå› åˆ†æ

**é—®é¢˜æ ¹æº**: é…ç½®æ–‡ä»¶è·¯å¾„è§£æé”™è¯¯

1. `src/agent/document_agent.py` ä¸­çš„ `load_agent_config()` å‡½æ•°ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `Path("config/agents.yaml")`
2. å½“ä»é¡¹ç›®æ ¹ç›®å½•å¤–çš„ä½ç½®è¿è¡ŒCLIå‘½ä»¤æ—¶ï¼Œç›¸å¯¹è·¯å¾„å¤±æ•ˆ
3. å¯¼è‡´é…ç½®åŠ è½½å¤±è´¥ï¼Œè¿”å›ç©ºé…ç½®å­—å…¸ï¼Œ`enabled` é»˜è®¤ä¸º `False`

## ä¿®å¤æ–¹æ¡ˆ

**æ–‡ä»¶**: `src/agent/document_agent.py`
**è¡Œå·**: 45-80

### ä¿®æ”¹å‰

```python
def load_agent_config(agent_name: str = "document") -> dict:
    """ä»é…ç½®æ–‡ä»¶åŠ è½½Agenté…ç½®"""
    config_file = Path("config/agents.yaml")
    if config_file.exists():
        try:
            with open(config_file, "r", encoding="utf-8") as f:
                config = yaml.safe_load(f)
                return config.get("sub_agents", {}).get(agent_name, {})
        except Exception as e:
            logger.warning(f"åŠ è½½Agenté…ç½®å¤±è´¥: {e}")
    return {}
```

### ä¿®æ”¹å

```python
def load_agent_config(agent_name: str = "document") -> dict:
    """ä»é…ç½®æ–‡ä»¶åŠ è½½Agenté…ç½®"""
    # è·å–é¡¹ç›®æ ¹ç›®å½•ï¼ˆç›¸å¯¹äºsrcç›®å½•çš„ä¸Šçº§ç›®å½•ï¼‰
    import os
    current_file = Path(__file__).resolve()
    project_root = current_file.parent.parent.parent
    config_file = project_root / "config" / "agents.yaml"

    logger.debug(f"å°è¯•åŠ è½½é…ç½®æ–‡ä»¶: {config_file}")
    logger.debug(f"é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨: {config_file.exists()}")

    if config_file.exists():
        try:
            with open(config_file, "r", encoding="utf-8") as f:
                config = yaml.safe_load(f)
                agent_config = config.get("sub_agents", {}).get(agent_name, {})
                logger.debug(f"Agent '{agent_name}' é…ç½®: {agent_config}")
                return agent_config
        except Exception as e:
            logger.warning(f"åŠ è½½Agenté…ç½®å¤±è´¥: {e}")
            logger.warning(f"é…ç½®æ–‡ä»¶è·¯å¾„: {config_file}")
    else:
        logger.warning(f"é…ç½®æ–‡ä»¶ä¸å­˜åœ¨: {config_file}")
        # å°è¯•ç›¸å¯¹è·¯å¾„ä½œä¸ºåå¤‡
        try:
            fallback_config = Path("config/agents.yaml")
            if fallback_config.exists():
                with open(fallback_config, "r", encoding="utf-8") as f:
                    config = yaml.safe_load(f)
                    agent_config = config.get("sub_agents", {}).get(agent_name, {})
                    logger.debug(f"ä½¿ç”¨ç›¸å¯¹è·¯å¾„åŠ è½½Agent '{agent_name}' é…ç½®: {agent_config}")
                    return agent_config
        except Exception as e:
            logger.warning(f"åå¤‡é…ç½®åŠ è½½ä¹Ÿå¤±è´¥: {e}")

    return {}
```

## ä¿®å¤ç‰¹ç‚¹

1. **ç»å¯¹è·¯å¾„è§£æ**: ä½¿ç”¨ `Path(__file__).resolve()` è·å–é¡¹ç›®æ ¹ç›®å½•
2. **å®¹é”™æœºåˆ¶**: ä¿ç•™ç›¸å¯¹è·¯å¾„ä½œä¸ºåå¤‡æ–¹æ¡ˆ
3. **å¢å¼ºæ—¥å¿—**: æ·»åŠ è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—ä¾¿äºé—®é¢˜æ’æŸ¥
4. **å‘åå…¼å®¹**: ä¸å½±å“ç°æœ‰åŠŸèƒ½

## éªŒè¯ç»“æœ

### âœ… æµ‹è¯•é€šè¿‡

1. **CLI askå‘½ä»¤**: `python3 -m src.cli.commands ask "æµ‹è¯•é—®é¢˜"` - æ­£å¸¸å·¥ä½œ
2. **CLI chatå‘½ä»¤**: `python3 -m src.cli.commands chat -d` - æ­£å¸¸å·¥ä½œ
3. **é…ç½®åŠ è½½**: Document Agentæ­£ç¡®è¯†åˆ«ä¸ºå¯ç”¨çŠ¶æ€
4. **æ¨¡å‹æ˜¾ç¤º**: æ­£ç¡®æ˜¾ç¤ºæ¨¡å‹åç§° `minimax/minimax-m2:free`

### éªŒè¯è¾“å‡ºç¤ºä¾‹

```
å¼€å§‹å¯¹è¯ (ä¼šè¯ID: bd9e2aea-96a6-4c47-a081-72cefed42a12)
ğŸ“ æ¨¡å‹: minimax/minimax-m2:free (æ¸©åº¦: 0.1)
è¾“å…¥ 'exit' æˆ– 'quit' é€€å‡º
ğŸ’¡ æç¤º: æ€è€ƒè¿‡ç¨‹å±•ç¤ºå·²å¯ç”¨ (è¯¦ç»†æ¨¡å¼)
```

## æŠ€æœ¯è¦ç‚¹

1. **è·¯å¾„è®¡ç®—**: `Path(__file__).parent.parent.parent` ä» `src/agent/document_agent.py` è®¡ç®—åˆ°é¡¹ç›®æ ¹ç›®å½•
2. **è·¨å¹³å°å…¼å®¹**: ä½¿ç”¨ `pathlib.Path` ç¡®ä¿è·¨æ“ä½œç³»ç»Ÿå…¼å®¹æ€§
3. **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸æ•è·å’Œæ—¥å¿—è®°å½•
4. **æ€§èƒ½ä¼˜åŒ–**: é…ç½®æ–‡ä»¶ä»ä¸ºå•æ¬¡åŠ è½½ï¼Œæ— æ€§èƒ½æŸå¤±

## å½±å“èŒƒå›´

- âœ… CLIå‘½ä»¤è¡Œå·¥å…·å®Œå…¨æ¢å¤
- âœ… Agentåˆ›å»ºæµç¨‹æ­£å¸¸
- âœ… é…ç½®ç³»ç»Ÿç¨³å®š
- âœ… æ— å‰¯ä½œç”¨å½±å“å…¶ä»–åŠŸèƒ½

**æ€»ç»“**: é—®é¢˜å·²å½»åº•è§£å†³ï¼ŒCLIå‘½ä»¤ç°åœ¨å¯ä»¥ä»ä»»ä½•ç›®å½•æ­£å¸¸è¿è¡Œã€‚